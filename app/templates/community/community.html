{% extends "layout.html" %}

{% block title %}äº’åŠ¨ç¤¾åŒº - çŸ³æ¦´ç±½å®¶å›­{% endblock %}

{% block head %}
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
{% endblock %}

{% block content %}
  <!-- äº’åŠ¨ç¤¾åŒº -->
  <section class="py-24 bg-[#FDEDEC]" id="community">
    <div class="px-28">
      <div class="text-center mb-20">
        <h2 class="text-4xl font-serif text-[#2C3E50] mb-4">æˆ‘ä»¬åœ¨ä¸€èµ·</h2>
        <p class="text-xl text-gray-600 max-w-3xl mx-auto">è¿æ¥å„æ°‘æ—å­¦å­ï¼Œå…±åˆ›å…±äº«æ–‡åŒ–äº¤æµçš„ç¾å¥½æ—¶åˆ»</p>
      </div>
      <div class="grid grid-cols-3 gap-8">
        <!-- ä»»åŠ¡ç³»ç»Ÿ -->
        <div class="col-span-2 bg-white rounded-2xl shadow-xl p-8">
          <div class="flex justify-between items-center mb-8">
            <h3 class="text-2xl font-semibold text-[#E74C3C]">å…±å­¦å…±ä¹ä»»åŠ¡</h3>
            <a href="{{ url_for('community.tasks') }}" class="text-[#3498DB] hover:text-[#2980B9]" title="æŸ¥çœ‹å…¨éƒ¨ä»»åŠ¡">æŸ¥çœ‹å…¨éƒ¨</a>
          </div>
          <div class="space-y-6">
            <!-- åŠ¨æ€ä»»åŠ¡å¡ç‰‡ -->
            {% if tasks %}
              {% for task in tasks %}
                {% set user_task = user_tasks.get(task.id) %}
                {% set progress = user_task.progress if user_task else 0 %}
                <div class="bg-gray-50 p-6 rounded-xl border-l-4" style="border-left-color: {{ task.color }}">
                  <div class="flex items-start">
                    <div class="flex-shrink-0" style="background-color: {{ task.color }}; color: white; width: 120px; height: 120px; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 20px;">
                      <span class="iconify" data-icon="{{ task.icon }}" data-width="48"></span>
                    </div>
                    <div class="flex-grow">
                      <h4 class="font-semibold text-xl mb-2">{{ task.title }}</h4>
                      <p class="text-gray-600 mb-4">{{ task.description }}</p>
                      <div class="flex items-center">
                        <div class="w-full bg-gray-200 rounded-full h-2">
                          <div class="bg-[#27AE60] h-2 rounded-full" style="width: {{ progress }}%"></div>
                        </div>
                        <span class="ml-4 text-sm text-gray-600">{{ progress }}%å®Œæˆ</span>
                      </div>
                    </div>
                  </div>
                </div>
              {% endfor %}
            {% else %}
              <div class="text-center py-12 text-gray-500">
                <p>æš‚æ— ä»»åŠ¡ï¼Œæ•¬è¯·æœŸå¾…ï¼</p>
              </div>
            {% endif %}
          </div>
        </div>
        <!-- æ•…äº‹æ‚è´§é“º -->
        <div class="bg-white rounded-2xl shadow-xl p-8">
          <div class="flex justify-between items-center mb-8">
            <h3 class="text-2xl font-semibold text-[#E74C3C]">æ•…äº‹æ‚è´§é“º</h3>
            <a href="{{ url_for('community.stories') }}" class="text-[#3498DB] hover:text-[#2980B9] flex items-center">
              æ›´å¤šæ•…äº‹ <span class="iconify ml-1" data-icon="mdi:chevron-right" data-width="16"></span>
            </a>
          </div>
          <div class="space-y-6">
            <div class="p-4 border border-gray-200 rounded-lg hover:border-[#E74C3C] transition">
              <div class="flex items-center mb-3">
                <img alt="ç”¨æˆ·å¤´åƒ - è—æ—å­¦ç”Ÿ" class="w-10 h-10 rounded-full mr-3" id="user-1" src="https://modao.cc/agent-py/workspace/691b233af5ce15fe6e795003/generated_images/877982c52ef84ee69dfb5feea2120ab9.jpg"/>
                <div>
                  <div class="font-semibold">å“ç›</div>
                  <div class="text-sm text-gray-500">è—æ—Â·åŒ—äº¬å¸ˆèŒƒå¤§å­¦</div>
                </div>
              </div>
              <p class="text-gray-700 line-clamp-3">ç¬¬ä¸€æ¬¡å’Œæ±‰æ—åŒå­¦ä¸€èµ·è¿‡è—å†æ–°å¹´ï¼Œæ•™ä»–ä»¬åšé…¥æ²¹èŒ¶...ï¼ˆé˜…è¯»æ›´å¤šï¼‰</p>
              <div class="flex justify-between mt-3 text-sm text-gray-500">
                <div>2å°æ—¶å‰</div>
                <div class="flex space-x-4">
                  <span>128 â¤ï¸</span>
                  <span>24 ğŸ’¬</span>
                </div>
              </div>
            </div>
            <div class="p-4 border border-gray-200 rounded-lg hover:border-[#E74C3C] transition">
              <div class="flex items-center mb-3">
                <img alt="ç”¨æˆ·å¤´åƒ - æ±‰æ—å­¦ç”Ÿ" class="w-10 h-10 rounded-full mr-3" id="user-2" src="https://modao.cc/agent-py/workspace/691b233af5ce15fe6e795003/generated_images/51e85d69689147afadd655efbb23f311.jpg"/>
                <div>
                  <div class="font-semibold">å¼ æµ©ç„¶</div>
                  <div class="text-sm text-gray-500">æ±‰æ—Â·äº‘å—å¤§å­¦</div>
                </div>
              </div>
              <p class="text-gray-700 line-clamp-3">å‚åŠ äº†å‚£æ—æ³¼æ°´èŠ‚ï¼Œæ„Ÿå—åˆ°ä¸åŒæ–‡åŒ–ä¸­çš„æ¬¢ä¹ä¸ç¥ç¦...ï¼ˆé˜…è¯»æ›´å¤šï¼‰</p>
              <div class="flex justify-between mt-3 text-sm text-gray-500">
                <div>1å¤©å‰</div>
                <div class="flex space-x-4">
                  <span>89 â¤ï¸</span>
                  <span>16 ğŸ’¬</span>
                </div>
              </div>
            </div>
          </div>
          <a href="{{ url_for('community.create_story') }}" class="w-full mt-8 bg-gradient-to-r from-[#8E44AD] to-[#3498DB] text-white py-3 rounded-lg inline-block text-center">
            åˆ†äº«æˆ‘çš„æ•…äº‹
          </a>
        </div>
      </div>
      <!-- åŒè·³ä¸€æ”¯èˆæ´»åŠ¨ -->
      <div class="mt-16 bg-white rounded-2xl shadow-xl p-8">
        <div class="flex items-center justify-between">
          <div>
            <h3 class="text-2xl font-semibold text-[#E74C3C]">åŒè·³ä¸€æ”¯èˆÂ·æ°‘æ—èˆè¹ˆæ¨¡ä»¿èµ›</h3>
            <p class="text-gray-600">ä¸Šä¼ æ°‘æ—èˆè¹ˆè§†é¢‘ï¼ŒAIè¯†åˆ«åŠ¨ä½œå‡†ç¡®åº¦å¹¶è¯„åˆ†</p>
          </div>
          <a href="{{ url_for('community.dance_selection') }}" class="bg-gradient-to-r from-[#E74C3C] to-[#F39C12] text-white px-8 py-3 rounded-lg inline-block">
            ç«‹å³å‚ä¸
          </a>
        </div>
        <div class="mt-6 grid grid-cols-4 gap-4">
          <div class="bg-gray-100 aspect-square rounded-xl flex items-center justify-center">
            <img alt="æ°‘æ—èˆè¹ˆç¤ºèŒƒ - è—æ—èˆè¹ˆåŠ¨ä½œ" class="w-full h-full object-cover" id="dance-1" src="https://modao.cc/agent-py/workspace/691b233af5ce15fe6e795003/generated_images/fd7faf0634b24eee90757cca666a1505.jpg"/>
          </div>
          <div class="bg-gray-100 aspect-square rounded-xl flex items-center justify-center">
            <img alt="æ°‘æ—èˆè¹ˆç¤ºèŒƒ - è’™å¤æ—èˆè¹ˆåŠ¨ä½œ" class="w-full h-full object-cover" id="dance-2" src="https://modao.cc/agent-py/workspace/691b233af5ce15fe6e795003/generated_images/bd0cb4f15ddf4783ac1ea0192c1d0b59.jpg"/>
          </div>
          <div class="bg-gray-100 aspect-square rounded-xl flex items-center justify-center">
            <img alt="æ°‘æ—èˆè¹ˆç¤ºèŒƒ - å“ˆè¨å…‹æ—èˆè¹ˆåŠ¨ä½œ" class="w-full h-full object-cover" id="dance-3" src="https://modao.cc/agent-py/workspace/691b233af5ce15fe6e795003/generated_images/90885c005c21408e8242e893e0f87c8e.jpg"/>
          </div>
          <div class="bg-gray-100 aspect-square rounded-xl flex items-center justify-center">
            <img alt="æ°‘æ—èˆè¹ˆç¤ºèŒƒ - å½æ—èˆè¹ˆåŠ¨ä½œ" class="w-full h-full object-cover" id="dance-4" src="https://modao.cc/agent-py/workspace/691b233af5ce15fe6e795003/generated_images/d2f09a3eca744b76b4f39db8e5a02d18.jpg"/>
          </div>
        </div>
      </div>
      
      <!-- ç¤¾åŒºå¸–å­åˆ—è¡¨ -->
      <div class="mt-16">
        <div class="flex flex-wrap justify-between items-center mb-8">
          <h3 class="text-2xl font-semibold text-[#E74C3C] mb-4 md:mb-0">ç¤¾åŒºå¸–å­</h3>
          <div class="flex items-center space-x-4">
            <div class="flex flex-wrap gap-2">
              <a href="{{ url_for('community.index') }}" class="px-4 py-2 rounded-full transition {{ 'bg-[#E74C3C] text-white' if not request.args.get('category') else 'bg-gray-200 text-gray-700 hover:bg-gray-300' }}">
                å…¨éƒ¨
              </a>
              {% for category in categories %}
                <a href="{{ url_for('community.index', category=category) }}" class="px-4 py-2 rounded-full transition {{ 'bg-[#E74C3C] text-white' if request.args.get('category') == category else 'bg-gray-200 text-gray-700 hover:bg-gray-300' }}">
                  {{ category }}
                </a>
              {% endfor %}
            </div>
            <a href="{{ url_for('community.create') }}" class="bg-gradient-to-r from-[#E74C3C] to-[#F39C12] text-white px-6 py-2 rounded-full">
              å‘å¸ƒæ–°å¸–
            </a>
          </div>
        </div>
        
        <div class="space-y-6">
          {% for post in posts %}
          <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition">
            <h3 class="text-xl font-semibold text-[#2C3E50] mb-2">{{ post.title }}</h3>
            <p class="text-gray-600 mb-4">{{ post.content[:150] }}...</p>
            <div class="flex items-center text-gray-500 text-sm">
              <span class="iconify mr-1" data-icon="mdi:calendar"></span>
              <span class="mr-4">{{ post.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
              <span class="iconify mr-1" data-icon="mdi:comment-outline"></span>
              <span class="mr-4">{{ post.comments | length }}</span>
              <span class="iconify mr-1" data-icon="mdi:eye"></span>
              <span>128</span>
              <a href="{{ url_for('community.post', id=post.id) }}" class="ml-auto text-[#E74C3C] hover:text-[#C0392B]">æŸ¥çœ‹è¯¦æƒ…</a>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </section>
{% endblock %}